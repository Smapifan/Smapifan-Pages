<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profi Discord Bot Builder</title>
<style>
body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
h1 { color: #333; }
button, input, textarea { margin: 5px 0; padding: 8px; width: 100%; }
#commandsContainer { margin-top: 20px; }
.command { background: #fff; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
textarea { width: 100%; height: 120px; }
</style>
</head>
<body>

<h1>Profi Discord Bot Builder</h1>

<div>
  <label>Bot-Ordner auswählen:</label>
  <input type="file" id="folderInput" webkitdirectory directory multiple>
</div>

<div>
  <label>GitHub Repo (Link + Token):</label>
  <input type="text" id="githubLink" placeholder="Repo Link z.B. https://github.com/user/repo">
  <input type="text" id="githubToken" placeholder="Personal Access Token (falls privat)">
  <button id="importGithubBtn">GitHub Repo importieren</button>
</div>

<div>
  <button id="addCommandBtn">Neuen Befehl erstellen</button>
  <button id="generateBtn">JS-Code generieren</button>
  <button id="downloadBtn">Projekt als ZIP speichern</button>
</div>

<div id="commandsContainer"></div>
<textarea id="output" placeholder="Hier erscheint der generierte JS-Code..."></textarea>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
let commands = [];

// ===== Befehl erstellen =====
function createCommand(name="Neuer Befehl", code="// JS-Code hier"){
    const command = { id: Date.now(), name, code };
    commands.push(command);
    renderCommands();
}

// ===== Befehle rendern =====
function renderCommands(){
    const container = document.getElementById("commandsContainer");
    container.innerHTML = "";
    commands.forEach(c=>{
        const div = document.createElement("div");
        div.className = "command";
        div.innerHTML = `
            <label>Name:</label>
            <input type="text" value="${c.name}" oninput="updateCommandName(${c.id}, this.value)">
            <br>
            <label>JS-Code:</label>
            <textarea oninput="updateCommandCode(${c.id}, this.value)">${c.code}</textarea>
            <br>
            <button onclick="removeCommand(${c.id})">Befehl löschen</button>
        `;
        container.appendChild(div);
    });
}

// ===== Befehl Update & Remove =====
function updateCommandName(id, value){
    const command = commands.find(c=>c.id===id);
    if(command) command.name = value;
}
function updateCommandCode(id, value){
    const command = commands.find(c=>c.id===id);
    if(command) command.code = value;
}
function removeCommand(id){
    commands = commands.filter(c=>c.id!==id);
    renderCommands();
}

// ===== Ordnerintegration =====
document.getElementById("folderInput").addEventListener("change", e=>{
    const files = e.target.files;
    for(let file of files){
        if(file.name.endsWith(".js")){
            const reader = new FileReader();
            reader.onload = (evt)=>{
                createCommand(file.name, evt.target.result);
            };
            reader.readAsText(file);
        }
    }
});

// ===== GitHub Integration =====
async function importGithubRepo(repoUrl, token){
    try{
        const parts = repoUrl.replace("https://github.com/", "").split("/");
        const owner = parts[0];
        const repo = parts[1];

        async function fetchFiles(path=""){
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
            const res = await fetch(url, {
                headers: token ? { Authorization: `token ${token}` } : {}
            });
            if(!res.ok) throw new Error("GitHub API Fehler");
            const data = await res.json();
            for(const file of data){
                if(file.type === "file" && file.name.endsWith(".js")){
                    const fileRes = await fetch(file.download_url);
                    const content = await fileRes.text();
                    createCommand(file.name, content);
                } else if(file.type === "dir"){
                    await fetchFiles(file.path);
                }
            }
        }

        await fetchFiles();
        renderCommands();
        alert("GitHub Repo erfolgreich importiert!");
    } catch(err){
        alert("Fehler beim Import: " + err.message);
    }
}

document.getElementById("importGithubBtn").addEventListener("click", ()=>{
    const url = document.getElementById("githubLink").value;
    const token = document.getElementById("githubToken").value;
    if(url) importGithubRepo(url, token);
});

// ===== JS-Code generieren =====
document.getElementById("generateBtn").addEventListener("click", ()=>{
    let code = "";
    commands.forEach(c=>{
        code += `// ===== ${c.name} =====\n${c.code}\n\n`;
    });
    document.getElementById("output").value = code;
});

// ===== Projekt als ZIP speichern =====
document.getElementById("downloadBtn").addEventListener("click", ()=>{
    const zip = new JSZip();
    commands.forEach(c=>{
        zip.file(c.name+".js", c.code);
    });
    zip.generateAsync({type:"blob"}).then(content=>{
        saveAs(content, "projekt.zip");
    });
});

// ===== Button Befehl erstellen =====
document.getElementById("addCommandBtn").addEventListener("click", ()=>createCommand());

</script>

</body>
</html>
