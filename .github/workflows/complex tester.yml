# .github/workflows/code_analysis.yml
name: Auto Code Analysis

on:
  push:             # läuft bei jedem Push
  pull_request:     # und jedem Pull‑Request
    # (optional: du kannst hier spezifische Branches definieren oder alle zulassen)  

jobs:
  analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: write   # damit der Workflow committen darf

    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        with:
          fetch-depth: 0  # vollständige history (empfohlen bei automatischen Commits) :contentReference[oaicite:1]{index=1}

      - name: Install cloc
        run: sudo apt-get update && sudo apt-get install -y cloc

      - name: Count lines of code
        run: |
          cloc . --exclude-dir=node_modules,assets,dist --quiet --csv --out=code_stats.csv
        # Ergebnis: CSV‑Datei mit Statistik im Repo‑Root

      - name: Add and commit report
        uses: stefanzweifel/git-auto-commit-action@v7
        with:
          commit_message: "auto: update code_stats.csv"
          branch: ${{ github.ref_name }}  # derselbe Branch wie aktuell :contentReference[oaicite:2]{index=2}
          file_pattern: "code_stats.csv"
